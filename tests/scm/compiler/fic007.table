;; -*- scheme -*-

;; This is a definition for a fictional chip called "fix007". It uses
;; chip-remote's domain specific description languange to define meta
;; information about the chip, its registers, custom decoders and encoder and
;; maps those encoder/decoders to entries.

;; Meta information:

(name 'fic007)
(manufacturer "Fictional Instruments")
(datasheet-code 'FIC007)
(datasheet-uri "http://www.fic-inc.tld/ds/fic007.pdf")

(register-width 8)
(default-value #x42)

;; Register definitions

(register #x0
  #:default #x54
  #:contents (m-divider #:offset 0 #:width 4)
             (n-divider #:offset 4 #:width 4))

(register #x1
  #:default #xd0
  #:contents (power-save #:offset 0 #:width 1)
             (reference-divider #:offset 4 #:width 4))

(register #x2
  #:default #xf0
  #:contents (gain #:offset 0 #:width 6)
             (rate #:offset 6 #:width 2))

(register #xf
  #:default #xc8
  #:contents (self-destruct #:offset 0 #:width 1)
             (deploy-coffee #:offset 2 #:width 3)
             (read-paper #:offset 7 #:width 1))

(register #x10
  #:default #xc8
  #:contents (lvds-strength #:offset 0 #:width 2))

;; Decoders:

(decoder (lvds-strength-map) #:type alist)

(decode-using (lvds-strength-map) lvds-strength)

;; Encoders:

(encoder (lvds-strength-map) #:type reverse-alist)

(encode-using (lvds-strength-map) lvds-strength)
